<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Streaming Dashboard - Serverless Spark</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a1a;
            --bg-secondary: #12122a;
            --bg-card: #1a1a3a;
            --accent-primary: #6366f1;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #2a2a4a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            padding: 24px;
            border-right: 1px solid var(--border-color);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-primary), #8b5cf6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 600;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }
        
        .nav-item:hover, .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: var(--accent-primary);
        }
        
        .nav-item.active {
            background: rgba(99, 102, 241, 0.2);
        }
        
        /* Main Content */
        .main-content {
            padding: 24px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #5558e3;
        }
        
        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .metric-icon.messages { background: rgba(99, 102, 241, 0.2); }
        .metric-icon.latency { background: rgba(16, 185, 129, 0.2); }
        .metric-icon.executors { background: rgba(245, 158, 11, 0.2); }
        .metric-icon.alerts { background: rgba(239, 68, 68, 0.2); }
        
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .metric-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            margin-top: 8px;
        }
        
        .trend-up { color: var(--accent-success); }
        .trend-down { color: var(--accent-danger); }
        
        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .chart-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .chart-canvas {
            height: 250px;
            background: var(--bg-secondary);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        
        /* Temperature Spike Alert */
        .alert-banner {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            border: 1px solid var(--accent-danger);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: none;
            animation: pulse 2s infinite;
        }
        
        .alert-banner.active {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .alert-icon {
            font-size: 28px;
        }
        
        .alert-content h3 {
            color: var(--accent-danger);
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .alert-content p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .alert-actions {
            margin-left: auto;
        }
        
        .btn-danger {
            background: var(--accent-danger);
            color: white;
        }
        
        /* Sensors Table */
        .sensors-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }
        
        .sensors-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .sensors-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .sensors-table th,
        .sensors-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .sensors-table th {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 13px;
            text-transform: uppercase;
        }
        
        .sensor-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
        }
        
        .status-normal {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }
        
        .status-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent-warning);
        }
        
        .status-critical {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .temp-value {
            font-weight: 600;
        }
        
        .temp-high {
            color: var(--accent-danger);
        }
        
        .temp-normal {
            color: var(--accent-success);
        }
        
        /* Real-time indicator */
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--accent-success);
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-success);
            border-radius: 50%;
            animation: pulse-dot 1.5s infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
        }
        
        /* Sparkline */
        .sparkline {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 30px;
        }
        
        .sparkline-bar {
            width: 4px;
            background: var(--accent-primary);
            border-radius: 2px;
            transition: height 0.3s;
        }
        
        /* RL Decision Panel */
        .rl-panel {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid var(--accent-primary);
            border-radius: 12px;
            padding: 16px;
        }
        
        .rl-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .rl-badge {
            background: var(--accent-primary);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .rl-decision {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-success);
            margin-bottom: 8px;
        }
        
        .rl-reason {
            color: var(--text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">‚ö°</div>
                <span class="logo-text">Spark IoT</span>
            </div>
            
            <nav>
                <div class="nav-item active">üìä Dashboard</div>
                <div class="nav-item">üìà Analytics</div>
                <div class="nav-item">üå°Ô∏è Sensors</div>
                <div class="nav-item">üîî Alerts</div>
                <div class="nav-item">‚öôÔ∏è Settings</div>
                <div class="nav-item">ü§ñ RL Agent</div>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h1>Real-time IoT Monitoring</h1>
                <div class="header-actions">
                    <div class="live-indicator">
                        <span class="live-dot"></span>
                        Live
                    </div>
                    <button class="btn btn-primary" onclick="simulateSpike()">Simulate Spike</button>
                </div>
            </div>
            
            <!-- Temperature Spike Alert -->
            <div class="alert-banner" id="spike-alert">
                <span class="alert-icon">üî•</span>
                <div class="alert-content">
                    <h3>TEMPERATURE SPIKE DETECTED!</h3>
                    <p id="alert-details">Sensor SC-001 reporting 78¬∞C (threshold: 45¬∞C). RL scaling executors from 4 ‚Üí 12.</p>
                </div>
                <div class="alert-actions">
                    <button class="btn btn-danger" onclick="acknowledgeAlert()">Acknowledge</button>
                </div>
            </div>
            
            <!-- Metrics Grid -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon messages">üì®</div>
                        <div class="sparkline" id="msg-sparkline"></div>
                    </div>
                    <div class="metric-value" id="msg-rate">1,234</div>
                    <div class="metric-label">Messages / sec</div>
                    <div class="metric-trend trend-up">‚Üë 12% from avg</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon latency">‚è±Ô∏è</div>
                    </div>
                    <div class="metric-value" id="latency">80</div>
                    <div class="metric-label">Avg Latency (ms)</div>
                    <div class="metric-trend trend-up">‚úì Under SLA</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon executors">üñ•Ô∏è</div>
                    </div>
                    <div class="metric-value" id="executors">4</div>
                    <div class="metric-label">Spark Executors</div>
                    <div class="metric-trend" id="executor-trend">RL Controlled</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon alerts">üö®</div>
                    </div>
                    <div class="metric-value" id="alerts-count">0</div>
                    <div class="metric-label">Active Alerts</div>
                    <div class="metric-trend trend-up">All clear</div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">Message Rate & Temperature</span>
                        <span style="color: var(--text-secondary); font-size: 13px;">Last 60 seconds</span>
                    </div>
                    <div class="chart-canvas" id="main-chart">
                        <canvas id="realtime-canvas"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">RL Agent Decision</span>
                    </div>
                    <div class="rl-panel">
                        <div class="rl-header">
                            <span class="rl-badge">RL AGENT</span>
                            <span style="color: var(--text-secondary); font-size: 12px;">via OpenFaaS</span>
                        </div>
                        <div class="rl-decision" id="rl-decision">MAINTAIN</div>
                        <div class="rl-reason" id="rl-reason">Normal load (150 msg/s). Optimal capacity maintained.</div>
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: var(--text-secondary); font-size: 13px;">Confidence</span>
                                <span style="font-weight: 600;" id="rl-confidence">85%</span>
                            </div>
                            <div style="height: 6px; background: var(--bg-secondary); border-radius: 3px;">
                                <div id="confidence-bar" style="height: 100%; width: 85%; background: var(--accent-primary); border-radius: 3px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sensors Table -->
            <div class="sensors-section">
                <div class="sensors-header">
                    <span class="chart-title">Active Sensors</span>
                    <span style="color: var(--text-secondary); font-size: 13px;">12 connected</span>
                </div>
                <table class="sensors-table">
                    <thead>
                        <tr>
                            <th>Sensor ID</th>
                            <th>Type</th>
                            <th>Location</th>
                            <th>Temperature</th>
                            <th>Status</th>
                            <th>Last Update</th>
                        </tr>
                    </thead>
                    <tbody id="sensors-tbody">
                        <tr>
                            <td>SC-001</td>
                            <td>Temperature</td>
                            <td>Zone A</td>
                            <td class="temp-value temp-normal" id="sensor-1-temp">32.5¬∞C</td>
                            <td><span class="sensor-status status-normal">‚óè Normal</span></td>
                            <td>Just now</td>
                        </tr>
                        <tr>
                            <td>SC-002</td>
                            <td>Temperature</td>
                            <td>Zone B</td>
                            <td class="temp-value temp-normal">28.3¬∞C</td>
                            <td><span class="sensor-status status-normal">‚óè Normal</span></td>
                            <td>2s ago</td>
                        </tr>
                        <tr>
                            <td>SC-003</td>
                            <td>Humidity</td>
                            <td>Zone A</td>
                            <td class="temp-value">65%</td>
                            <td><span class="sensor-status status-normal">‚óè Normal</span></td>
                            <td>1s ago</td>
                        </tr>
                        <tr>
                            <td>SC-004</td>
                            <td>Pollution</td>
                            <td>Zone C</td>
                            <td class="temp-value">AQI 45</td>
                            <td><span class="sensor-status status-warning">‚óè Moderate</span></td>
                            <td>3s ago</td>
                        </tr>
                        <tr>
                            <td>SC-005</td>
                            <td>Traffic</td>
                            <td>Zone D</td>
                            <td class="temp-value">124 veh/hr</td>
                            <td><span class="sensor-status status-normal">‚óè Normal</span></td>
                            <td>1s ago</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>
    
    <script>
        // Configuration
        const TEMP_THRESHOLD = 45; // ¬∞C
        const SPIKE_TEMP = 78; // ¬∞C
        
        // State
        let messageRate = 150;
        let executors = 4;
        let temperature = 32.5;
        let isSpike = false;
        let alertActive = false;
        
        // Sparkline data
        let sparklineData = Array(20).fill(0).map(() => Math.random() * 30 + 20);
        
        // Initialize sparkline
        function renderSparkline() {
            const container = document.getElementById('msg-sparkline');
            container.innerHTML = '';
            sparklineData.forEach(val => {
                const bar = document.createElement('div');
                bar.className = 'sparkline-bar';
                bar.style.height = `${val}px`;
                container.appendChild(bar);
            });
        }
        
        // Update metrics
        function updateMetrics() {
            // Update message rate
            if (isSpike) {
                messageRate = 450 + Math.random() * 100;
                temperature = SPIKE_TEMP + Math.random() * 5;
            } else {
                messageRate = 150 + Math.random() * 50 - 25;
                temperature = 30 + Math.random() * 5;
            }
            
            document.getElementById('msg-rate').textContent = Math.round(messageRate).toLocaleString();
            
            // Update sparkline
            sparklineData.shift();
            sparklineData.push(Math.min(50, messageRate / 10));
            renderSparkline();
            
            // Update temperature
            const tempEl = document.getElementById('sensor-1-temp');
            tempEl.textContent = temperature.toFixed(1) + '¬∞C';
            
            if (temperature > TEMP_THRESHOLD) {
                tempEl.className = 'temp-value temp-high';
            } else {
                tempEl.className = 'temp-value temp-normal';
            }
            
            // Update RL decision
            updateRLDecision();
        }
        
        // Update RL decision panel
        function updateRLDecision() {
            const decisionEl = document.getElementById('rl-decision');
            const reasonEl = document.getElementById('rl-reason');
            const confidenceEl = document.getElementById('rl-confidence');
            const confidenceBar = document.getElementById('confidence-bar');
            const executorEl = document.getElementById('executors');
            const executorTrend = document.getElementById('executor-trend');
            
            if (isSpike) {
                executors = 12;
                decisionEl.textContent = 'SCALE UP';
                decisionEl.style.color = '#f59e0b';
                reasonEl.textContent = `Temperature spike detected (${temperature.toFixed(1)}¬∞C)! Pre-scaling to ${executors} executors.`;
                confidenceEl.textContent = '95%';
                confidenceBar.style.width = '95%';
                confidenceBar.style.background = '#f59e0b';
                executorTrend.textContent = '‚Üë Scaling up';
                executorTrend.className = 'metric-trend trend-down';
            } else {
                if (executors > 4) {
                    executors = Math.max(4, executors - 2);
                    decisionEl.textContent = 'SCALE DOWN';
                    decisionEl.style.color = 'var(--accent-primary)';
                    reasonEl.textContent = `Temperature normalized. Scaling down to ${executors} executors.`;
                } else {
                    executors = 4;
                    decisionEl.textContent = 'MAINTAIN';
                    decisionEl.style.color = 'var(--accent-success)';
                    reasonEl.textContent = `Normal load (${Math.round(messageRate)} msg/s). Optimal capacity maintained.`;
                }
                confidenceEl.textContent = '85%';
                confidenceBar.style.width = '85%';
                confidenceBar.style.background = 'var(--accent-primary)';
                executorTrend.textContent = 'RL Controlled';
                executorTrend.className = 'metric-trend';
            }
            
            executorEl.textContent = executors;
        }
        
        // Simulate temperature spike
        function simulateSpike() {
            isSpike = true;
            alertActive = true;
            
            // Show alert
            document.getElementById('spike-alert').classList.add('active');
            document.getElementById('alerts-count').textContent = '1';
            
            // Update sensor status
            const tbody = document.getElementById('sensors-tbody');
            const firstRow = tbody.querySelector('tr');
            const statusCell = firstRow.querySelector('.sensor-status');
            statusCell.className = 'sensor-status status-critical';
            statusCell.textContent = '‚óè CRITICAL';
            
            document.getElementById('alert-details').textContent = 
                `Sensor SC-001 reporting ${SPIKE_TEMP}¬∞C (threshold: ${TEMP_THRESHOLD}¬∞C). RL scaling executors from 4 ‚Üí 12.`;
            
            // Auto-resolve after 10 seconds
            setTimeout(() => {
                if (isSpike) {
                    isSpike = false;
                }
            }, 10000);
        }
        
        // Acknowledge alert
        function acknowledgeAlert() {
            isSpike = false;
            alertActive = false;
            
            document.getElementById('spike-alert').classList.remove('active');
            document.getElementById('alerts-count').textContent = '0';
            
            // Reset sensor status
            const tbody = document.getElementById('sensors-tbody');
            const firstRow = tbody.querySelector('tr');
            const statusCell = firstRow.querySelector('.sensor-status');
            statusCell.className = 'sensor-status status-normal';
            statusCell.textContent = '‚óè Normal';
        }
        
        // Draw simple chart
        function drawChart() {
            const canvas = document.getElementById('realtime-canvas');
            const ctx = canvas.getContext('2d');
            const container = document.getElementById('main-chart');
            
            canvas.width = container.offsetWidth;
            canvas.height = 250;
            
            // Clear
            ctx.fillStyle = '#12122a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = '#2a2a4a';
            ctx.lineWidth = 1;
            for(let i = 0; i < 5; i++) {
                const y = 50 + i * 40;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw sparkline data as area chart
            ctx.beginPath();
            ctx.moveTo(0, 250);
            
            sparklineData.forEach((val, i) => {
                const x = (i / (sparklineData.length - 1)) * canvas.width;
                const y = 250 - (val * 4);
                ctx.lineTo(x, y);
            });
            
            ctx.lineTo(canvas.width, 250);
            ctx.closePath();
            
            const gradient = ctx.createLinearGradient(0, 0, 0, 250);
            gradient.addColorStop(0, 'rgba(99, 102, 241, 0.5)');
            gradient.addColorStop(1, 'rgba(99, 102, 241, 0.1)');
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // Draw line
            ctx.beginPath();
            sparklineData.forEach((val, i) => {
                const x = (i / (sparklineData.length - 1)) * canvas.width;
                const y = 250 - (val * 4);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.strokeStyle = '#6366f1';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Temperature warning line if spike
            if (isSpike) {
                ctx.beginPath();
                ctx.moveTo(0, 80);
                ctx.lineTo(canvas.width, 80);
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.fillStyle = '#ef4444';
                ctx.font = '12px Inter';
                ctx.fillText('Temperature Threshold', 10, 75);
            }
        }
        
        // Initialize
        renderSparkline();
        
        // Update loop
        setInterval(() => {
            updateMetrics();
            drawChart();
        }, 1000);
        
        // Initial draw
        drawChart();
    </script>
</body>
</html>
